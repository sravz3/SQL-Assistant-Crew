query_task:
  description: |
    You are an expert SQL assistant. Your job is to translate user requests into SQL queries using ONLY the tables and columns listed below.
    SCHEMA:
    {db_schema}
    USER REQUEST:
    {user_input}
    IMPORTANT DATA MODEL RELATIONSHIPS:
    - order_items contains sales data and can link to product_variants via EITHER variant_id OR sku
    - product_variants links to products via product_id
    - products link to brands via brand_id
    - inventory contains stock data and links to product_variants ONLY via variant_id (integer FK)
    - For sales/revenue queries: order_items → product_variants → products → brands
    - For inventory queries: inventory → product_variants → products → brands
    - BOTH approaches are valid for sales: JOIN on variant_id OR JOIN on sku (order_items.sku = product_variants.sku)
    - order_items.sku matches product_variants.sku (both use VAR- prefix)
    - products.sku uses SKU- prefix (different from order_items)
    - CRITICAL: inventory table has NO SKU field - only variant_id, warehouse_id, quantity
    IMPORTANT:
    - First, list which tables and columns from the schema you will use to answer the request.
    - Then, write the SQL query using the correct table relationships above.
    - Only use the tables and columns from the schema above.
    - If the request cannot be satisfied with the schema, return a SQL comment (starting with --) explaining why.
    - Do NOT invent tables or columns.
    - Make sure the query matches the user's intent as closely as possible.
  expected_output: First, a list of tables and columns to use. Then, a syntactically correct SQL query using appropriate filters, joins, and groupings.

review_task:
  description: |
    Review the following SQL query for correctness, performance, and readability: {sql_query} and verify that the query fits the schema: {db_schema}
    Ensure that only tables and columns from the provided schema are used.
    IMPORTANT DATA MODEL RELATIONSHIPS:
    - order_items contains sales data and can link to product_variants via EITHER variant_id OR sku
    - product_variants links to products via product_id
    - products link to brands via brand_id
    - inventory contains stock data and links to product_variants ONLY via variant_id (integer FK)
    - For sales/revenue queries: order_items → product_variants → products → brands
    - For inventory queries: inventory → product_variants → products → brands
    - BOTH approaches are valid for sales: JOIN on variant_id OR JOIN on sku (order_items.sku = product_variants.sku)
    - order_items.sku matches product_variants.sku (both use VAR- prefix)
    - products.sku uses SKU- prefix (different from order_items)
    - CRITICAL: inventory table has NO SKU field - only variant_id, warehouse_id, quantity
    IMPORTANT:
    - First, only review the SQL query provided for correctness, performance, or readability
    - Check if the query uses correct table relationships (both variant_id and sku joins are valid for sales data)
    - Do NOT invent new tables or columns.
    - If the Query is already correct, return it unchanged.
    - If the Query is not correct and cannot be fixed, return a SQL comment (starting with --) explaining why.
  expected_output: An optimized or verified SQL query

compliance_task:
  description: >
    Review the following SQL query for compliance violations, including PII access, unsafe usage, or policy violations.
    List any issues found, or state "No issues found" if the query is compliant.
    SQL Query: {reviewed_sqlquery}
  expected_output: >
    A markdown-formatted compliance report listing any flagged issues, or stating that the query is compliant. Include a clear verdict at the top (e.g., "Compliant" or "Issues found").

    